(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();class A{constructor(){this.routeDefs=[],this.DEBUGROUTER=!1}when(e,...t){return this.routeDefs.push({route:e,funcs:t}),this}redirect(e,t,s){const n=this.routeDefs.find(i=>i.route===t),r=n?n.funcs:[];return this.when(e,s,...r),this}notfound(...e){return this.when("<notfound>",...e),this}do(...e){return this.when("<do>",...e),this}async exe(e){if(!e.uri)throw new Error('The "uri" property is required on trx transitional Router object.');const t=this._uriParser(e.uri),s=this.routeDefs.find(d=>{const c=this._routeParser(d.route);return this._routeRegexMatchNoParams(c,t)||this._routeWithParamsMatch(c,t)}),n=this.routeDefs.find(d=>d.route==="<notfound>"),r=this.routeDefs.find(d=>d.route==="<do>"),i=new Date;if(s){const d=this._routeParser(s.route);e.query=t.queryObject,e.params=d?this._getParams(d.full,t.path):{};for(const c of s.funcs)this._isFunction(c),await c(e)}else if(n)for(const d of n.funcs)this._isFunction(d),await d(e);if(r&&r.funcs&&r.funcs.length)for(const d of r.funcs)this._isFunction(d),await d(e);const o=new Date;return e.elapsedTime=o-i+" ms",e}_routeRegexMatchNoParams(e,t){const n=new RegExp(`^${e.full}$`,"i").test(t.path),r=e.segments===t.segments,i=n&&r;return this.DEBUGROUTER&&console.log(`
_routeRegexMatchNoParams:: (route) ${e.full} - (uri) ${t.path} -> ${i}`),i}_routeWithParamsMatch(e,t){const n=new RegExp(`^${e.base}/`,"i").test(t.path),r=e.segments===t.segments,i=/\/\:/.test(e.full),o=n&&r&&i;return this.DEBUGROUTER&&console.log(`_routeWithParamsMatch:: (route) ${e.full} - (uri) ${t.path} -> ${o}`),o}_removeSlashes(e){return e.trim().replace(/^\/+/,"").replace(/\/+$/,"")}_stringTypeConvert(e){function t(s){try{JSON.parse(s)}catch{return!1}return!0}return e&&!isNaN(e)&&e.indexOf(".")===-1?e=parseInt(e,10):e&&!isNaN(e)&&e.indexOf(".")!==-1?e=parseFloat(e):(e==="true"||e==="false"||t(e))&&(e=JSON.parse(e)),e}_toQueryObject(e){const t=e.split("&"),s={};let n,r,i;return t.forEach(o=>{n=o.split("="),r=n[0],i=n[1],i=this._stringTypeConvert(i),s[r]=i}),s}_uriParser(e){const t=e.split("?"),s=this._removeSlashes(t[0]),n=s.split("/").length,r=t[1],i=r?this._toQueryObject(r):{};return{path:s,segments:n,queryString:r,queryObject:i}}_routeParser(e){const t=this._removeSlashes(e),s=t.split("/").length,n=t.replace(/\/\:.+/,"");return{full:t,segments:s,base:n}}_getParams(e,t){const s=e.split("/"),n=t.split("/"),r={};return s.forEach((i,o)=>{if(/\:/.test(i)){const d=i.replace(/^\:/,"");let c=n[o];c=this._stringTypeConvert(c),r[d]=c}}),r}_isFunction(e){if(typeof e!="function")throw new Error(`ERR_Router:: The func parameter with value "${e}" is not a function`)}}class S{constructor(){this.activeOns=[]}emit(e,t={}){const s=new CustomEvent(e,{detail:t});window.dispatchEvent(s)}on(e,t){const s=n=>{t.call(null,n)};this._removeOne(e,t),this.activeOns.push({eventName:e,listener:t,listenerWindow:s}),window.addEventListener(e,s)}once(e,t){const s=n=>{t.call(null,n),this._removeOne(e,t,s)};window.addEventListener(e,s,{once:!0})}off(e,t){this._removeOne(e,t)}offAll(e){let t=0;for(const s of this.activeOns)s.eventName===e&&(window.removeEventListener(s.eventName,s.listenerWindow),this.activeOns.splice(t,1)),t++}deaf(){for(const e of this.activeOns)window.removeEventListener(e.eventName,e.listenerWindow);this.activeOns=[]}getListeners(e){let t=[...this.activeOns];return t=t.filter(s=>s.eventName===e),t}_removeOne(e,t){if(!t)throw new Error("eventEmitter._removeOne Error: listener is not defined");let s=0;for(const n of this.activeOns)n.eventName===e&&n.listener.toString()===t.toString()&&(window.removeEventListener(n.eventName,n.listenerWindow),this.activeOns.splice(s,1)),s++}}const m=new S;class C{constructor(){this.previous={uri:"",ctrl:null},this.current={uri:"",ctrl:null}}_setPrevious(){this.previous={...this.current}}_setCurrent(e){const t=this.getCurrentURI();this.current={uri:t,ctrl:e}}async _resetPreviousController(){const e=this.previous.ctrl;if(!e)return;await e.__destroy(),e.$destroyflight&&await e.$destroyflight(),e.ddUNLISTEN(),e.emptyModel();const t=Object.keys(e);for(const s of t)s!=="$appName"&&s!=="$auth"&&s!=="$fridge"&&s!=="$httpClient"&&s!=="$debugOpts"&&s!=="$destroyflight"&&s!=="$model"&&s!=="$modeler"&&s!=="$dd"&&delete e[s];e.$elem={},e.$dd.listeners=[],e.$model={}}async navigMdw(e){f._setPrevious(),await f._resetPreviousController(),f._setCurrent(e)}getPrevioustURI(){return this.previous.uri}getCurrentURI(){return window.location.pathname+window.location.search}onPushstate(e){m.on("pushstate",e)}onPopstate(e){window.addEventListener("popstate",e)}onHashchange(e){window.addEventListener("hashchange",e)}onUrlChange(e){this.onPushstate(e),this.onPopstate(e)}goto(e,t,s){if(!e)throw new Error('The argument "url" is not defined');t||(t={}),s||(s=""),t={...t,url:e},window.history.pushState(t,s,e),m.emit("pushstate",t)}goblind(e,t,s){if(!e)throw new Error('The argument "url" is not defined');t||(t={}),s||(s=""),t={...t,url:e},window.history.pushState(t,s,e)}forward(){window.history.forward()}back(){window.history.back()}history(e){window.history.go(e)}reload(){window.location.reload()}}const f=new C;class k extends A{constructor(e){super(),this.$appName=e||"dodoApp",window[this.$appName]={i18n:{}},this.ctrls={},this.ctrlConstants={$appName:this.$appName},this.$debugOpts={},this.$preflight=[],this.$postflight=[],this._setAppStyle()}fridge(e){return this.ctrlConstants.$fridge=e,this}httpClient(e){return this.ctrlConstants.$httpClient=e,this}auth(e){for(const t of Object.keys(this.ctrls)){const s=this.ctrls[t].$auth;s.login=s.login.bind(s),s.logout=s.logout.bind(s),s.getLoggedUserInfo=s.getLoggedUserInfo.bind(s),s.setLoggedUserInfo=s.setLoggedUserInfo.bind(s),s.getJWTtoken=s.getJWTtoken.bind(s)}return this.ctrlConstants.$auth=e,this}debug(e){return this.$debugOpts=e,this.ctrlConstants.$debugOpts=this.$debugOpts,this}preflight(e){if(!Array.isArray(e))throw new Error("The $preflight is not array");for(const t of e)if(typeof t!="function")throw new Error(`The $preflight func "${t}" is not a function`);return this.$preflight=e,this}postflight(e){if(!Array.isArray(e))throw new Error("The $postflight is not array");for(const t of e)if(typeof t!="function")throw new Error(`The $postflight func "${t}" is not a function`);return this.$postflight=e,this}destroyflight(e){if(typeof e!="function")throw new Error(`The $destroyflight "${e}" is not a function`);return this.ctrlConstants.$destroyflight=e,this}async i18n(e){if(!e){const t=await Object.assign({});e={};for(const s in t){const n=await t[s](),r=s.split("/"),i=r[2],o=r[3].replace(".json","");e[i]||(e[i]={}),e[i][o]=n}}window[this.$appName].i18n=e}routes(e){for(const t of e){if(!t||t&&!Array.isArray(t)||t&&!t.length)throw new Error(`Invalid route definition ${t}`);const s=t[0];if(s==="when"){const n=t[1],r=t[2],i=t[3]||{};if(!r)throw new Error(`Controller "${r.name}" is not defined or not injected in the App.`);const o=new r(this);this._saveController(r.name,o);const d=f.navigMdw.bind(f,o),c=i.authGuards||[],l=this.$preflight,a=o.controllerMdw.bind(o),h=this.$postflight;this.when(n,...c,d,...l,a,...h)}else if(s==="notfound"){const n=t[1];if(!n)throw new Error(`Controller "${n.name}" is not defined or not injected in the App.`);const r=new n(this);this._saveController(n.name,r);const i=f.navigMdw.bind(f,r),o=r.controllerMdw.bind(r);this.notfound(i,o)}else if(s==="do"){const n=t[1];this.do(...n)}else if(s==="redirect"){const n=t[1],r=t[2],i=()=>{window.history.pushState(null,"",r)};this.redirect(n,r,i)}}return{listen:this.listen.bind(this)}}listen(){const e=async t=>{var r,i;let s=f.getCurrentURI();s=decodeURI(s),(r=this.$debugOpts)!=null&&r.exeRoute&&console.log(`%c --------- exeRoute (start) "${s}" ------`,"color:#680C72; background:#E59FED");let n={uri:s,pevent:t};n=await this.exe(n).catch(o=>console.error(o)),n&&((i=this.$debugOpts)!=null&&i.exeRoute)&&(console.log(" --------- exeRoute trx::",n),console.log(`%c --------- exeRoute (end) "${s}" -- elapsedTime: ${n.elapsedTime} ------`,"color:#680C72; background:#E59FED"))};f.onUrlChange(e),e()}_saveController(e,t){for(const[s,n]of Object.entries(this.ctrlConstants))t[s]=n;return this.ctrls[e]=t,t}_setAppStyle(){const s=["dd-setinitial","dd-elem","dd-if","dd-elseif","dd-else","dd-visible","dd-text","dd-html","dd-value","dd-disabled","dd-checked","dd-selected","dd-class","dd-style","dd-src","dd-attr","dd-each","dd-repeat"].map(r=>`[${r}-hide]`).join(","),n=document.createElement("style");n.textContent=`${s} { display: none !important; }`,n.setAttribute("type","text/css"),document.head.appendChild(n)}}class T{_getControllerValue(e){try{const t=e.match(/([^[.\]]+)/g);if(!t){console.warn(`_getControllerValue (Bad controller property: this.${e})`);return}let s=this;for(const n of t)if(s&&n in s)s=s[n];else if(Array.isArray(s)&&!isNaN(n))s=s[parseInt(n)];else return;return s}catch(t){console.warn(`_getControllerValue (Bad controller property: this.${e})`,t);return}}_setControllerValue(e,t){try{const s=e.split(".");let n=this;for(let r=0;r<s.length-1;r++){const i=s[r];i in n||(n[i]={}),n=n[i]}n[s[s.length-1]]=t}catch(s){console.error(`_setControllerValue (${e})`,s)}}_listElements(e,t){let s=document.querySelectorAll(`[${e}]:not([dd-render-disabled])`);return s=Array.from(s),s=s.filter(n=>{let r=n.getAttribute(e)||"";r=r.trim();const{base:i,opts:o}=this._decomposeAttribute(r);return o.includes("forceRender")||this._hasDdRender(n,"enabled")?!0:t?r.includes("$model."+t)||/\(((?!\$\{|\$\$).)*\)/.test(r):!0}),s}_elemShow(e,t){e.removeAttribute(`${t}-hide`)}_elemHide(e,t){e.setAttribute(`${t}-hide`,"")}_getSiblings(e,t){const s=[];if(!e.parentNode)return s;let n=e.parentNode.firstChild,r=!1;for(;n;){if(n===e&&(r=!0),r&&n!==e&&n.nodeType===1&&n.hasAttribute(t[0])){r=!1;break}if(r&&n.nodeType===1){for(const i of t)n.hasAttribute(i)&&s.push(n);if(r&&n.hasAttribute(t[t.length-1])){r=!1;break}}n=n.nextSibling}return s}_decomposeAttribute(e){let t=e.split("--")||[];return t=t.map(n=>n.trim()),{base:t.shift(),opts:t}}_setElementValue(e,t=""){typeof t=="object"?e.type==="textarea"?t=JSON.stringify(t,null,2):t=JSON.stringify(t):t=this._val2str(t),e.value=t,e.setAttribute("value",t)}_setElementChecked(e,t=""){t=this._val2str(t),t.includes(e.value)?(e.checked=!0,e.setAttribute("checked","")):(e.checked=!1,e.removeAttribute("checked"))}_setElementSelected_one(e,t=""){t=this._val2str(t);for(const s of e.options)t===s.value?(s.selected=!0,s.setAttribute("selected","")):(s.selected=!1,s.removeAttribute("selected"))}_setElementSelected_multiple(e,t=""){for(const s of e.options)t.includes(s.value)?(s.selected=!0,s.setAttribute("selected","")):(s.selected=!1,s.removeAttribute("selected"))}_getElementValue(e,t=!0){let s;if(e.type==="checkbox"){const n=document.querySelectorAll(`[name="${e.name}"]`),r=[];let i=1;for(const o of n){let d=o.value;t&&(d=this._stringTypeConvert(o.value)),o.checked&&(r.push(d),s=r),i===n.length&&!s&&(s=[]),i++}}else if(e.type==="select-multiple"){const n=e.selectedOptions,r=[];let i=1;for(const o of n){let d=o.value;t&&(d=this._stringTypeConvert(o.value)),r.push(d),s=r,i===n.length&&!s&&(s=[]),i++}}else if(e.type==="radio"){let n=e.value;t&&(n=this._stringTypeConvert(e.value)),e.checked&&(s=n)}else if(e.type==="number")s=e.valueAsNumber||void 0;else if(e.type==="password")s=e.value;else if(e.type==="file"&&e.multiple)s=e.files;else if(e.type==="file")s=e.files[0];else{let n=e.value;t&&(n=this._stringTypeConvert(e.value)),s=n}return s}_clone_define(e,t,s){const n=e.cloneNode(!0);return n.removeAttribute(t),t==="dd-if"&&(n.removeAttribute("dd-else"),n.removeAttribute("dd-elseif")),n.setAttribute(`${t}-clone`,s),n}_clone_insert(e,t){e.parentNode.insertBefore(t,e)}_clone_remove(e,t){const s=e.getAttribute("dd-id");if(!s)return;const n=document.querySelectorAll(`[${t}-clone][dd-id="${s}"]`);for(const r of n)r.remove()}_setDdRender(e,t="disabled"){const s=`dd-render-${t}`;e.setAttribute(s,""),[...this.$dd.noncloner_directives].forEach(r=>{e.querySelectorAll(`[${r}]`).forEach(o=>{o.setAttribute(s,"")})})}_delDdRender(e,t="disabled"){const s=`dd-render-${t}`;e.removeAttribute(s),[...this.$dd.noncloner_directives].forEach(r=>{e.querySelectorAll(`[${r}]`).forEach(o=>{o.removeAttribute(s)})})}_purgeDdRender(e="disabled"){const t=`dd-render-${e}`,s=document.querySelectorAll(`[${t}]`);for(const n of s)n.removeAttribute(t)}_hasDdRender(e,t="disabled"){const s=`dd-render-${t}`;return e.hasAttribute(s)}_solveBase(e){if(!e)return;let t="";if(/^[a-zA-Z0-9_$]+\(.*\)$/.test(e)){const s=e,{funcName:n,funcArgs:r}=this._funcParse(s,null,null);try{t=this[n](...r)}catch(i){this._printError(`${i.message}. Check ${s}`)}}else{const s=e.replace(/^this\./,"");t=this._getControllerValue(s)}return t}_solveMustache(e,t){const s=this._flattenObject(t);return e.replace(/{{\s*([^{}\s]+)\s*}}/g,(n,r)=>s[r]!==void 0?s[r]:n)}_funcParse(e,t,s){if(!e)return{};const n=e.match(/^(.+)\((.*)\)$/);if(!n)return console.error(`_funcParseErr: Function "${e}" has bad definition.`),{};const r=n[1]||"",i=n[2]?n[2].trim():"",o=i?i.split(",").map(d=>{if(d=d.trim(),d==="$element")d=t;else if(d==="$value")d=this._getElementValue(t,!0);else if(d==="$event")d=s;else if(/"|'/.test(d))d=d.replace(/\'/g,"");else if(/^-?\d+\.?\d*$/.test(d)&&!/\'/.test(d))d=+d;else if(d==="true"||d==="false")d=JSON.parse(d);else if(/^\/.+\/i?g?$/.test(d)){const c=d.match(/^\/(.+)\/(i?g?)$/);d=new RegExp(c[1],c[2])}else if(/^\$model\./.test(d)){const c=d;d=this._getControllerValue(c)}else if(/^this\./.test(d)){const c=d.replace(/^this\./,"");d=this._getControllerValue(c)}else{const c=d;d=this._getControllerValue(c)}return d}):[];return{funcName:r,funcArgs:o,funcArgsStr:i}}async _funcExe(e,t){try{let s;if(/\./.test(e)){let n=e.split(".")||[];n=n.filter(o=>o!=="this");let r=this,i;for(const o of n)r=r[o],typeof r=="object"&&(i=r);r=r.bind(i),s=await r(...t)}else{if(!this[e])throw new Error(`Method "${e}" is not defined in the "${this.constructor.name}" controller.`);s=await this[e](...t)}return s}catch(s){console.error(s)}}async _funcsExe(e,t,s){const n=e.split(";").filter(r=>!!r).map(r=>r.trim());for(const r of n){const{funcName:i,funcArgs:o}=this._funcParse(r,t,s);await this._funcExe(i,o)}}_pipeExe(e,t){if(e==null||e&&typeof e!="string")return"";e=e.replace(/\n/g," ").replace(/\s+/g," ").replace(/\'|\`/g,"").trim();const s=t.replace("pipe:","").trim().split(".");try{for(const n of s){const r=n.match(/(\w+)\((.*)\)/);if(r){const[i,o,d]=r,c=d.split(",").map(l=>{if(l=l.trim(),l!=="undefined"){if(l==="null")return null;if(l==="NaN")return NaN;if(l==="true")return!0;if(l==="false")return!1;if(!isNaN(l))return Number(l);if(l.match(/^\/.*\/[gimsuy]*$/)){const a=l.match(/^\/(.*)\/([gimsuy]*)$/);return new RegExp(a[1],a[2])}return l.replace(/['"]/g,"")}});if(typeof String.prototype[o]=="function")e=String.prototype[o].apply(e,c);else throw new Error(`Unsupported method: ${o}`)}else throw new Error(`Invalid pipe function format: ${n}`)}return e}catch(n){return this._printError("_pipeExe:: Error in pipe execution",n),""}}_uid_generate(){const t=(Date.now()/1e3+"").split(".")[1],s=Math.round(Math.random()*1e3);return"uid_"+t+"_"+s}_uid(e){const t=this._uid_generate();e.setAttribute("dd-id",t)}_hasDirectives(e,t){let s="";for(const n of t){if(e.hasAttribute(n)){s=n;break}const r=e.querySelectorAll(`[${n}]`);for(const i of r)if(i.hasAttribute(n)){s=n;break}}return s}_stringTypeConvert(e){function t(s){try{JSON.parse(s)}catch{return!1}return!0}return e&&!isNaN(e)&&!/\./.test(e)?e=parseInt(e,10):e&&!isNaN(e)&&/\./.test(e)?e=parseFloat(e):(e==="true"||e==="false"||t(e))&&(e=JSON.parse(e)),e}_flattenObject(e,t="",s={}){for(const n in e)if(e.hasOwnProperty(n)){const r=t?`${t}.${n}`:n;typeof e[n]=="object"&&!Array.isArray(e[n])?this._flattenObject(e[n],r,s):s[r]=e[n]}return s}_unflattenObject(e){const t={};for(const s in e)if(e.hasOwnProperty(s)){const n=s.split(".");n.reduce((r,i,o)=>(o===n.length-1?r[i]=e[s]:r[i]=r[i]||{},r[i]),t)}return t}_val2str(e){if(e===null)return"null";if(e===void 0)return"undefined";if(typeof e=="boolean"||typeof e=="number"||typeof e=="bigint")return e.toString();if(typeof e=="string")return e;if(typeof e=="symbol"||typeof e=="function")return e.toString();if(typeof e=="object")try{return JSON.stringify(e)}catch{return e.toString()}return e.toString()}_debug(e,t,s,n){const r=this.$debugOpts||{};return r&&r[e]&&console.log(`%c ${t}`,`color: ${s}; background: ${n}`),r}_printError(e){console.log(`%c ERROR:: ${e}`,"color:Red; background:Yellow")}_printWarn(e){console.log(`%c WARNING:: ${e}`,"color:Maroon; background:LightYellow")}_isValidVariableName(e){return/^[_\$A-Za-z0-9]+$/.test(e)}}class O extends T{constructor(){super()}ddUNLISTEN(){this._debug("ddUNLISTEN",`------- ddUNLISTEN (start) ctrl: ${this.constructor.name} -------`,"orange","#FFD8B6");let e=1;for(const t of this.$dd.listeners)t.elem.removeEventListener(t.eventName,t.handler),this._debug("ddUNLISTEN",`${e}. killed:: ${t.attrName} --- ${t.eventName} --- ${t.elem.localName} -- ${t.elem.innerHTML} -- ctrl:: ${this.constructor.name}`,"orange"),e++;this.$dd.listeners=[],this._debug("ddUNLISTEN","------- ddUNLISTEN (end) -------","orange","#FFD8B6")}ddHref(){this._debug("ddHref","--------- ddHref ------","orange","#F4EA9E");const e="dd-href",t=this._listElements(e,"");this._debug("ddHref",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute("dd-href"),{base:r,opts:i}=this._decomposeAttribute(n),o=this._solveBase(r);this._debug("ddHref",`dd-href="${n}" :: ${r} = ${o}`,"orangered"),o&&s.setAttribute("href",o);const d=async l=>{l.preventDefault();const a=o||s.getAttribute("href"),h={href:a},p=s.innerText?s.innerText.trim():"";a&&f.goto(a,h,p),this._debug("ddHref",`Executed ddHref listener -->  href: ${a}, ctrl:: ${this.constructor.name}`,"orangered")},c="click";s.addEventListener(c,d),this.$dd.listeners.push({attrName:e,elem:s,handler:d,eventName:c}),this._debug("ddHref",`pushed::  tag: ${s.localName} | href="${s.pathname}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddSet(){this._debug("ddSet","--------- ddSet ------","orange","#F4EA9E");const e="dd-set",t=this._listElements(e,"");this._debug("ddSet",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),{base:r,opts:i}=this._decomposeAttribute(n),o=r.replace(/^this\./,""),d=i[0]==="convertType",c=async a=>{const h=this._getElementValue(s,d);this._setControllerValue(o,h),this._debug("ddSet",`Executed ddSet listener --> ${r} = ${h} - convertType: ${d}`,"orangered")},l="input";s.addEventListener(l,c),this.$dd.listeners.push({attrName:e,elem:s,handler:c,eventName:l}),this._debug("ddSet",`pushed::  tag: ${s.localName} | dd-set="${n}" | ctrl="${this.constructor.name}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddModel(){this._debug("ddModel","--------- ddModel ------","orange","#F4EA9E");const e="dd-model",t=this._listElements(e,"");this._debug("ddModel",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),{base:r,opts:i}=this._decomposeAttribute(n);let o=r.replace(/^this\./,"");o&&!o.includes("$model")&&(o="$model."+o);const d=i[0]==="convertType",c=this._getControllerValue(o);s.type==="checkbox"||s.type==="radio"?this._setElementChecked(s,c):s.type==="select-one"?(this._setElementValue(s,c),this._setElementSelected_one(s,c)):s.type==="select-multiple"?(this._setElementValue(s,c),this._setElementSelected_multiple(s,c)):this._setElementValue(s,c),this._debug("ddModel",`ddModel set the element value  --> ${r} = ${c} | elem.type:: ${s.type}`,"orangered");const l=async h=>{const p=this._getElementValue(s,d);this._setControllerValue(o,p),this._debug("ddModel",`Executed ddModel listener --> ${r} = ${p}`,"orangered")},a="input";s.addEventListener(a,l),this.$dd.listeners.push({attrName:e,elem:s,handler:l,eventName:a}),this._debug("ddModel",`pushed::  tag: ${s.localName} | dd-set="${n}" | ctrl="${this.constructor.name}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddClick(){this._debug("ddClick","--------- ddClick ------","orange","#F4EA9E");const e="dd-click",t=this._listElements(e,"");this._debug("ddClick",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),{base:r,opts:i}=this._decomposeAttribute(n),o=i.includes("preventDefault"),d=async l=>{o&&l.preventDefault(),await this._funcsExe(r,s,l),this._debug("ddClick",`Executed ddClick listener --> ${r} | preventDefault: ${o}`,"orangered")},c="click";s.addEventListener(c,d),this.$dd.listeners.push({attrName:e,elem:s,handler:d,eventName:c}),this._debug("ddClick",`pushed::  tag: ${s.localName} | dd-click="${n}" | preventDefault: ${o} | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddEnter(){this._debug("ddEnter","--------- ddEnter ------","orange","#F4EA9E");const e="dd-enter",t=this._listElements(e,"");this._debug("ddEnter",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),{base:r,opts:i}=this._decomposeAttribute(n),o=i.includes("preventDefault"),d=async l=>{(l.code?l.code.toLowerCase():"")==="enter"&&(o&&l.preventDefault(),await this._funcsExe(r,s,l),this._debug("ddEnter",`Executed ddEnter listener --> ${r}`,"orangered"))},c="keyup";s.addEventListener(c,d),this.$dd.listeners.push({attrName:e,elem:s,handler:d,eventName:c}),this._debug("ddEnter",`pushed::  tag: ${s.localName} | dd-enter="${n}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddKeyup(){this._debug("ddKeyup","--------- ddKeyup ------","orange","#F4EA9E");const e="dd-keyup",t=this._listElements(e,"");this._debug("ddKeyup",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),{base:r,opts:i}=this._decomposeAttribute(n),o=i[0],d=async l=>{const a=l.code?l.code.toLowerCase():"";o&&o!==a||(await this._funcsExe(r,s,l),this._debug("ddKeyup",`Executed ddKeyup listener --> ${r} | eventCode: ${a}`,"orangered"))},c="keyup";s.addEventListener(c,d),this.$dd.listeners.push({attrName:e,elem:s,handler:d,eventName:c}),this._debug("ddKeyup",`pushed::  tag: ${s.localName} | dd-keyup="${n}" | ctrl="${this.constructor.name}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddChange(){this._debug("ddChange","--------- ddChange ------","orange","#F4EA9E");const e="dd-change",t=this._listElements(e,"");this._debug("ddChange",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),{base:r}=this._decomposeAttribute(n),i=async d=>{await this._funcsExe(r,s,d),this._debug("ddChange",`Executed ddChange listener --> ${r}`,"orangered")},o="change";s.addEventListener(o,i),this.$dd.listeners.push({attrName:e,elem:s,handler:i,eventName:o}),this._debug("ddChange",`pushed::  tag: ${s.localName} | dd-change="${n}" | ctrl="${this.constructor.name}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}ddEvt(){this._debug("ddEvt","--------- ddEvt ------","orange","#F4EA9E");const e="dd-evt",t=this._listElements(e,"");this._debug("ddEvt",`found elements:: ${t.length}`,"orange");for(const s of t){const n=s.getAttribute(e),r=n.split("&&").map(i=>i.trim());for(const i of r){const{base:o,opts:d}=this._decomposeAttribute(i),c=d[0];if(!c){this._printError(`dd-evt="${n}" -> The eventName is not defined`);continue}const l=async a=>{await this._funcsExe(o,s,a),this._debug("ddEvt",`Executed ddEvt listener --> ${o}`,"orangered")};s.addEventListener(c,l),this.$dd.listeners.push({attrName:e,elem:s,handler:l,eventName:c}),this._debug("ddEvt",`pushed::  tag: ${s.localName} | dd-evt="${n}" | ctrl="${this.constructor.name}" | ddListeners: ${this.$dd.listeners.length}`,"orange")}}}}class x extends O{constructor(){super()}ddEach(e){var n;this._debug("ddEach",`--------- ddEach (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-each",s=this._listElements(t,e);this._debug("ddEach",`found elements:: ${s.length}`,"navy");for(const r of s){const i=r.getAttribute(t),{base:o,opts:d}=this._decomposeAttribute(i),c=this._solveBase(o);if(!c){this._printError(`The ${o} has undefined value in dd-each="${i}"`);continue}if(!Array.isArray(c)){this._printError(`The ${o} value in dd-each="${i}" is not an array.`);continue}(n=this.$debugOpts)!=null&&n.ddEach&&console.log(`
ddEach:: attrVal:: ${i} , base:: ${o} -->`,c);const[l,a]=d.length?d[0].split(",").map(g=>g.trim()):[];if(!this._isValidVariableName(l)){this._printError(`dd-each="${i}" has invalid valName:${l}`);continue}if(!this._isValidVariableName(a)){this._printError(`dd-each="${i}" has invalid keyName:${a}`);continue}this._clone_remove(r,t),this._setDdRender(r,"disabled");const h=this._clone_define(r,t,i);this._elemShow(h,t),this._setDdRender(h,"enabled"),this._delDdRender(h,"disabled");const p=h.outerHTML;let _="";c.forEach((g,v)=>{_+=this._solveMustache(p,{[l]:g,[a]:v})}),r.insertAdjacentHTML("afterend",_)}}ddRepeat(e){this._debug("ddRepeat",`--------- ddRepeat (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-repeat",s=this._listElements(t,e);this._debug("ddRepeat",`found elements:: ${s.length}`,"navy");const n=[...s].reverse();for(const r of n){const i=r.getAttribute(t),{base:o}=this._decomposeAttribute(i),d=this._solveBase(o);if(!d){this._printError(`The ${o} has undefined value in dd-repeat="${i}"`);continue}this._debug("ddRepeat",`dd-repeat="${i}" :: ${o} = ${d}`,"navy"),this._clone_remove(r,t),this._setDdRender(r,"disabled");const c=r.getAttribute("dd-id"),l=this._hasDirectives(r,["dd-each"]);if(l){this._printError(`dd-repeat="${i}" dd-id="${c}" contains ${l}`);continue}const a=+d;if(a)for(let h=1;h<=a;h++){const p=this._clone_define(r,t,i);this._delDdRender(p,"disabled"),this._elemShow(p,t),this._clone_insert(r,p)}}this._debug("ddRepeat","--------- ddRepeat (end) ------","navy","#B6ECFF")}}class R extends x{constructor(){super(),this.$dd={listeners:[],noncloner_directives:["dd-setinitial","dd-elem","dd-if","dd-elseif","dd-else","dd-visible","dd-text","dd-html","dd-value","dd-disabled","dd-checked","dd-selected","dd-class","dd-style","dd-src","dd-attr"],cloner_directives:["dd-each","dd-repeat"]},this.$elem={}}ddSetinitial(){this._debug("ddSetinitial","--------- ddSetinitial ------","navy","#B6ECFF");const e="dd-setinitial",t=this._listElements(e);this._debug("ddSetinitial",`found elements:: ${t.length}`,"navy");for(const s of t){const n=s.getAttribute(e),{base:r,opts:i}=this._decomposeAttribute(n),o=r.replace(/^this\./,""),d=i[0]==="convertType",c=this._getElementValue(s,d);this._setControllerValue(o,c),this._debug("ddSetinitial",`dd-setinitial="${n}" :: ${r} = ${c} , convertType: ${d}`,"navy"),this._elemShow(s,e)}this._debug("ddSetinitial","--------- ddSetinitial (end) ------","navy","#B6ECFF")}ddElem(){this._debug("ddElem","--------- ddElem ------","navy","#B6ECFF");const e="dd-elem",t=this._listElements(e,"");this._debug("ddElem",`found elements:: ${t.length}`,"navy");for(const s of t){const n=s.getAttribute(e)||"",{base:r}=this._decomposeAttribute(n);this.$elem[r]=s,this._elemShow(s,e)}}ddText(e){this._debug("ddText",`--------- ddText (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-text",s=this._listElements(t,e);this._debug("ddText",`found elements:: ${s.length} `,"navy");for(const n of s){const r=n.getAttribute(t),{base:i,opts:o}=this._decomposeAttribute(r),d=this._solveBase(i);this._debug("ddText",`dd-text="${r}" :: ${i} = ${JSON.stringify(d)}`,"navy");let c=this._val2str(d);d==null&&(c="");const l=o.find(a=>a.includes("pipe:"));l&&(c=this._pipeExe(c,l)),n.textContent=c,this._elemShow(n,t)}this._debug("ddText","--------- ddText (end) ------","navy","#B6ECFF")}ddHtml(e){this._debug("ddHtml",`--------- ddHtml (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-html",s=this._listElements(t,e);this._debug("ddHtml",`found elements:: ${s.length} `,"navy");for(const n of s){const r=n.getAttribute(t),{base:i,opts:o}=this._decomposeAttribute(r),d=this._solveBase(i);this._debug("ddHtml",`dd-html="${r}" :: ${i} = ${d}`,"navy");let c=this._val2str(d);if(d==null&&(c=""),c.includes("dd-")){const a=c.includes("<td")?document.createElement("table"):document.createElement("div");a.innerHTML=c;const h=[...this.$dd.noncloner_directives,...this.$dd.cloner_directives];for(const p of h){const _=a.querySelectorAll(`[${p}]`);for(const g of _)this._elemHide(g,p),this._uid(g)}c=a.innerHTML}const l=o.find(a=>a.includes("pipe:"));l&&(c=this._pipeExe(c,l)),n.innerHTML=c,this._elemShow(n,t)}this._debug("ddHtml","--------- ddHtml (end) ------","navy","#B6ECFF")}ddValue(e){this._debug("ddValue",`--------- ddValue (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-value",s=this._listElements(t,e);this._debug("ddValue",`found elements:: ${s.length}`,"navy");for(const n of s){const r=n.getAttribute(t),{base:i}=this._decomposeAttribute(r),o=this._solveBase(i);this._debug("ddValue",`dd-value="${r}" :: ${i} = ${o}`,"navy"),this._elemShow(n,t),o!=null&&this._setElementValue(n,o)}this._debug("ddValue","--------- ddValue (end) ------","navy","#B6ECFF")}ddDisabled(e){this._debug("ddDisabled",`--------- ddDisabled (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-disabled",s=this._listElements(t,e);this._debug("ddDisabled",`found elements:: ${s.length}`,"navy");for(const n of s){const r=n.getAttribute(t),{base:i}=this._decomposeAttribute(r),o=this._solveBase(i);this._debug("ddDisabled",`dd-disabled="${r}" :: ${i} = ${o}`,"navy"),n.disabled=!!o,this._elemShow(n,t)}this._debug("ddDisabled","--------- ddDisabled (end) ------","navy","#B6ECFF")}ddChecked(e){this._debug("ddChecked",`--------- ddChecked (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-checked",s=this._listElements(t,e);this._debug("ddChecked",`found elements:: ${s.length}`,"navy");for(const n of s){const r=n.getAttribute(t),{base:i}=this._decomposeAttribute(r),o=this._solveBase(i);this._debug("ddChecked",`dd-checked="${r}" :: ${i} = ${o}`,"navy"),this._elemShow(n,t),o!==void 0&&(n.type==="checkbox"?(!Array.isArray(o)&&this._printError(`The checkbox expects an array. The incorrect value is ${o}.`),Array.isArray(o)&&o.indexOf(n.value)!==-1?(n.checked=!0,n.setAttribute("checked","")):(n.checked=!1,n.removeAttribute("checked"))):n.type==="radio"&&(Array.isArray(o)&&this._printError(`The radio doesn't expect an array. The incorrect value is ${o}.`),o===n.value?(n.checked=!0,n.setAttribute("checked","")):(n.checked=!1,n.removeAttribute("checked"))),this._debug("ddChecked",`   elem.value: ${n.value} ; elem.checked: ${n.checked}`,"navy"))}this._debug("ddChecked","--------- ddChecked (end) ------","navy","#B6ECFF")}ddSelected(e){this._debug("ddSelected",`--------- ddSelected (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-selected",s=this._listElements(t,e);this._debug("ddSelected",`found elements:: ${s.length}`,"navy");for(const n of s){const r=n.getAttribute(t),{base:i}=this._decomposeAttribute(r),o=this._solveBase(i);if(this._debug("ddSelected",`dd-selected="${r}" :: ${i} = ${o}`,"navy"),this._elemShow(n,t),o!==void 0){if(n.type==="select-multiple"){!Array.isArray(o)&&this._printError(`The select-multiple expects an array. The incorrect value is ${o}.`);for(const d of n.options)d.selected=Array.isArray(o)&&o.indexOf(d.value)!==-1}else if(n.type==="select-one"){Array.isArray(o)&&this._printError(`The select-one doesn't expect an array. The incorrect value is ${o}.`);for(const d of n.options)d.selected=o===d.value}}}this._debug("ddSelected","--------- ddSelected (end) ------","navy","#B6ECFF")}ddClass(e){this._debug("ddClass",`--------- ddClass (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-class",s=this._listElements(t,e);this._debug("ddClass",`found elements:: ${s.length}`,"navy");for(const n of s){const r=n.getAttribute(t),{base:i,opts:o}=this._decomposeAttribute(r),d=this._solveBase(i),c=o&&o[0]?o[0]:"";if(this._debug("ddClass",`dd-class="${r}" :: ${i} = ${JSON.stringify(d)} | act:: ${c}`,"navy"),this._elemShow(n,t),d!==void 0){if(!Array.isArray(d)){this._printWarn(`dd-class="${r}" -> The value is not array.`);continue}c==="replace"&&n.removeAttribute("class");for(const l of d)n.classList.add(l)}}this._debug("ddClass","--------- ddClass (end) ------","navy","#B6ECFF")}ddStyle(e){this._debug("ddStyle",`--------- ddStyle (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-style",s=this._listElements(t,e);this._debug("ddStyle",`found elements:: ${s.length}`,"navy");for(const n of s){const r=n.getAttribute(t),{base:i,opts:o}=this._decomposeAttribute(r),d=this._solveBase(i),c=o[0]||"";if(this._debug("ddStyle",`dd-style="${r}" :: ${i} = ${JSON.stringify(d)} | act:: ${c}`,"navy"),this._elemShow(n,t),d!==void 0){if(typeof d!="object"||typeof d=="object"&&Array.isArray(d)){this._printWarn(`dd-style="${r}" -> The value is not object.`);continue}if(c==="replace"&&n.removeAttribute("style"),d!==null)for(const l of Object.keys(d))n.style[l]=d[l]}}this._debug("ddStyle","--------- ddStyle (end) ------","navy","#B6ECFF")}ddSrc(e){this._debug("ddSrc",`--------- ddSrc (start)  -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-src",s=this._listElements(t,e);this._debug("ddSrc",`found elements:: ${s.length}`,"navy");for(const n of s){const r=n.getAttribute(t),{base:i,opts:o}=this._decomposeAttribute(r),d=this._solveBase(i),c=o[0]||"";this._debug("ddSrc",`dd-src="${r}" :: ${i} = ${d} | defaultSrc:: ${c}`,"navy");const l=d||c;n.src=l,this._elemShow(n,t)}this._debug("ddSrc","--------- ddSrc (end) ------","navy","#B6ECFF")}ddAttr(e){this._debug("ddAttr",`--------- ddAttr (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-attr",s=this._listElements(t,e);this._debug("ddAttr",`found elements:: ${s.length}`,"navy");for(const n of s){const r=n.getAttribute(t),{base:i,opts:o}=this._decomposeAttribute(r),d=this._solveBase(i),c=o[0]||"";if(this._debug("ddAttr",`dd-attr="${r}" :: ${i} = ${d} | attributeName:: ${c}`,"navy"),this._elemShow(n,t),d!=null){if(typeof d!="string"){this._printWarn(`dd-attr="${r}" -> The value is not string.`);continue}if(!c){this._printWarn(`dd-attr="${r}" -> The attribute name is not defined in option.`);continue}n.setAttribute(c,d)}}this._debug("ddAttr","--------- ddAttr (end) ------","navy","#B6ECFF")}ddIf(e){this._debug("ddIf",`--------- ddIf(start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-if",s=this._listElements(t,e);this._debug("ddIf",`found elements:: ${s.length} `,"navy");for(const n of s){const r=this._getSiblings(n,["dd-if","dd-elseif","dd-else"]);this._debug().ddIf&&console.log(`
--if group--`);for(const i of r)i.style.display="none";for(const i of r){const o=i.getAttribute("dd-if")||i.getAttribute("dd-elseif")||i.getAttribute("dd-else"),{base:d}=this._decomposeAttribute(o),c=this._solveBase(d);if(this._debug().ddIf&&console.log(i.outerHTML,c),c||i.hasAttribute("dd-else")){i.style.display="",n.getAttribute("style")||n.removeAttribute("style");break}}for(const i of r)this._elemShow(i,"dd-if"),this._elemShow(i,"dd-elseif"),this._elemShow(i,"dd-else");this._debug().ddIf&&console.log("----------")}this._debug("ddIf","--------- ddIf (end) ------","navy","#B6ECFF")}ddVisible(e){this._debug("ddVisible",`--------- ddVisible (start) -modelName:${e} ------`,"navy","#B6ECFF");const t="dd-visible",s=this._listElements(t,e);this._debug("ddVisible",`found elements:: ${s.length}`,"navy");for(const n of s){const r=n.getAttribute(t),{base:i}=this._decomposeAttribute(r),o=this._solveBase(i);this._debug("ddVisible",`dd-visible="${r}" :: ${i} = ${o}`,"navy"),o?n.style.visibility="visible":n.style.visibility="hidden",this._elemShow(n,t)}this._debug("ddVisible","--------- ddVisible (end) ------","navy","#B6ECFF")}}class y{constructor(e){var t,s,n;this.url,this.protocol="http:",this.hostname="",this.port=80,this.pathname="/",this.queryString="",e?this.opts=e:this.opts={encodeURI:!1,timeout:8e3,responseType:"",retry:3,retryDelay:5500,maxRedirects:3,headers:{authorization:"",accept:"*/*"}},this.timeout=((t=this.opts)==null?void 0:t.timeout)??8e3,this.responseType=((s=this.opts)==null?void 0:s.responseType)??"text",this.req_headers=(n=this.opts)!=null&&n.headers?{...this.opts.headers}:{},this.xhr=new XMLHttpRequest,this.interceptor}async askOnce(e,t="GET",s){const n={requestURL:e,requestMethod:t,status:0,statusMessage:"",https:!1,req:{headers:this.req_headers,payload:void 0},res:{headers:void 0,content:void 0},time:{req:this._getTime(),res:void 0,duration:void 0}};try{e=this._parseUrl(e),n.requestURL=e,n.https=/^https/.test(this.protocol)}catch(i){const o={...n};return o.status=400,o.statusMessage=i.message||"Bad Request",o.time.res=this._getTime(),o.time.duration=this._getTimeDiff(o.time.req,o.time.res),o}if(this.interceptor&&await this.interceptor(),this.xhr.open(t,e,!0,null,null),this._xhr_timeout(this.timeout),this._xhr_responseType(this.responseType),this._xhr_requestHeaders(this.req_headers),s&&!/GET/i.test(t)){n.req.payload=s;const i=this.req_headers["content-type"]||"";let o;/application\/json/.test(i)?o=JSON.stringify(s):o=s,this.xhr.send(o)}else this.xhr.send();return new Promise((i,o)=>{this.xhr.onload=d=>{const c={...n};c.status=this.xhr.status,c.statusMessage=this.xhr.statusText,c.res.headers=this.getResHeaders(),c.res.content=d.target.response,c.time.res=this._getTime(),c.time.duration=this._getTimeDiff(c.time.req,c.time.res),i(c)},this.xhr.onerror=d=>{this.kill();const c=this._formatError(d,e),l={...n};l.status=c.status,l.statusMessage=c.message,l.time.res=this._getTime(),l.time.duration=this._getTimeDiff(l.time.req,l.time.res),i(l)},this.xhr.ontimeout=()=>{this.kill();const d={...n};d.status=408,d.statusMessage=`Request aborted due to timeout (${this.timeout} ms) ${e} `,d.time.res=this._getTime(),d.time.duration=this._getTimeDiff(d.time.req,d.time.res),i(d)},setTimeout(()=>{const d={...n};d.status=408,d.statusMessage=`Server did not respond and timeout is forced after ${this.timeout} ms.`,d.time.res=this._getTime(),d.time.duration=this._getTimeDiff(d.time.req,d.time.res),i(d)},this.timeout)})}async ask(e,t="GET",s){let n=await this.askOnce(e,t,s);const r=[n];let i=1;for(;n&&/^3\d{2}/.test(n.status)&&i<=this.opts.maxRedirects;){const d=new URL(e,n.res.headers.location);console.log(`#${i} redirection ${n.status} from ${this.url} to ${d}`),n=await this.askOnce(d,t,s),r.push(n),i++}let o=1;for(;n.status===408&&o<=this.opts.retry;)console.log(`#${o} retry due to timeout (${this.timeout}) on ${e}`),await new Promise(d=>setTimeout(d,this.opts.retryDelay)),n=await this.askOnce(e,t,s),r.push(n),o++;return r}async askJSON(e,t="GET",s){let n=s;if(s&&typeof s=="string")try{n=JSON.parse(s)}catch{throw new Error("Body string is not valid JSON.")}this.setReqHeaders({accept:"application/json","content-type":"application/json; charset=utf-8"});const r=await this.askOnce(e,t,n);if(r.res.content)try{r.res.content=JSON.parse(r.res.content)}catch{throw new Error("Response content is not valid JSON.")}return r}async askHTML(e){return this.setReqHeaders({accept:"text/html","content-type":"text/html"}),await this.askOnce(e,"GET")}async askJS(e){return this.setReqHeaders({accept:"application/javascript","content-type":"application/javascript; charset=utf-8"}),await this.askOnce(e,"GET")}async askForm(e,t){this.setReqHeaders({accept:"*/*","content-type":"multipart/form-data"}),this.delReqHeaders(["content-type"]);const s=await this.askOnce(e,"POST",t);if(s.res.content)try{s.res.content=JSON.parse(s.res.content)}catch{console.log("WARNING: Response content is not JSON.")}return s}object2formdata(e){const t=new FormData;for(const[s,n]of Object.entries(e))t.set(s,n);return t}kill(){this.xhr.abort()}setInterceptor(e){this.interceptor=e.bind(this)}setReqHeaders(e){Object.keys(e).forEach(t=>{const s=t,n=e[t];this.setReqHeader(s,n)})}setReqHeader(e,t){e=e.toLowerCase(),this.req_headers[e]=t}delReqHeaders(e){e.forEach(t=>{t=t.toLowerCase(),delete this.req_headers[t]})}getReqHeaders(){return this.req_headers}getResHeaders(){const t=this.xhr.getAllResponseHeaders().split(`
`),s={};return t.forEach(n=>{const r=n.split(":"),i=r[0];if(i){const o=r[1].trim();s[i]=o}}),s}_parseUrl(e){e=this._correctUrl(e);const t=new URL(e);return this.url=e,this.protocol=t.protocol,this.hostname=t.hostname,this.port=t.port,this.pathname=t.pathname,this.queryString=t.search,e}_correctUrl(e){if(!e)throw new Error("URL is not defined");return e=e.trim(),/^https?:\/\//.test(e)||(e="http://"+e),this.opts.encodeURI?e=encodeURI(e):(e=e.replace(/\s+/g," "),e=e.replace(/ /g,"%20")),e}_formatError(e,t){const s=new Error(e);return e.target.status===0?(s.status=0,s.message=`Status:0 Bad Request ${t}`):(s.status=e.status||400,s.message=e.message),s.original=e,s}_getTime(){return new Date().toISOString()}_getTimeDiff(e,t){const s=new Date(e);return(new Date(t).getTime()-s.getTime())/1e3}_xhr_requestHeaders(e){Object.keys(e).forEach(t=>this.xhr.setRequestHeader(t.toLowerCase(),e[t]))}_xhr_timeout(e){this.xhr.timeout=+e||0}_xhr_responseType(e){this.xhr.responseType=e||"text"}}class L extends R{constructor(){super()}loadView(e,t="",s="inner",n=""){const r="dd-view";this.emptyView(e,s);const i=document.querySelector(`[${r}="${e}"]`);if(this._debug("loadView",`--------- loadView dd-view="${e}" ---------`,"#8B0892","#EDA1F1"),!i)throw new Error(`Element dd-view="${e}" not found.`);if(!t)throw new Error(`View content for dd-view="${e}" is not defined.`);let o=t;if(this._debug("loadView",`--htmlstr: ${o.length}`,"#8B0892"),n){const l=new DOMParser().parseFromString(o,"text/html").querySelector(n);o=l?l.outerHTML:""}o=this._hide_ddElements(o),s==="inner"?i.innerHTML=o:s==="sibling"?(i.insertAdjacentHTML("afterend",o),i.nextSibling.setAttribute("dd-view-clone",e)):s==="prepend"?(i.insertAdjacentHTML("afterbegin",o),i.firstElementChild.setAttribute("dd-view-clone",e)):s==="append"&&(i.insertAdjacentHTML("beforeend",o),i.lastElementChild.setAttribute("dd-view-clone",e))}emptyView(e,t="inner"){const s=document.querySelector(`[dd-view="${e}"]`);if(this._debug("emptyView",`--------- emptyView dd-view="${e}" | ${t} ---------`,"#8B0892","#EDA1F1"),this._debug().emptyView&&console.log("emptyView elem::",s),!s)throw new Error(`Element dd-view="${e}" not found.`);if(t==="inner")s.innerHTML="";else if(t==="sibling"||t==="prepend"||t==="append")for(const n of document.querySelectorAll(`[dd-view-clone="${e}"`))n.remove()}loadJS(e,t={}){this.unloadJS(e);const s=document.createElement("script");s.type="text/javascript",s.src=e,t.isModule&&s.setAttribute("type","module"),t.isDefer&&(s.defer=!0),t.isLazy&&s.setAttribute("dd-lazyjs",""),document.body.appendChild(s)}unloadJS(e){const t=document.body.querySelectorAll(`script[src="${e}"]`);for(const s of t)s&&s.remove()}unloadAllJS(e={}){let t="script";e.isModule&&(t+='[type="module"]'),e.isDefer&&(t+="[defer]"),e.isLazy&&(t+="[dd-lazyjs]");const s=document.querySelectorAll(t)||[];for(const n of s)n&&n.remove()}ddLazyjs(e){const t="dd-lazyjs",s=this._listElements(t);for(const n of s){const r=n.getAttribute(t),{opts:i}=this._decomposeAttribute(r);let o=i[0];if(o||(o="after__loader"),o!==e)return;this._debug("ddLazyjs",`--------- ddLazyjs (${e}) ------`,"navy","#B6ECFF");const d=n.getAttribute("src"),c=n.getAttribute("type")==="module",l=n.hasAttribute("defer"),a=n.hasAttribute("dd-lazyjs"),h={isModule:c,isDefer:l,isLazy:a};this.unloadJS(d),this.loadJS(d,h),this._debug("ddLazyjs",`src="${d}" | attrOpts: ${JSON.stringify(h)}`,"navy")}}async exeJS(e=""){const t=Object.getPrototypeOf(async function(){}).constructor;await new t(`${e};`)()}loadCSS(e){this.unloadCSS([e]);const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href",e),t.defer=!0,document.head.appendChild(t)}unloadCSS(e){const t=document.head.querySelectorAll(`link[rel="stylesheet"][href="${e}"]`);for(const s of t)s&&s.remove()}plugCSS(e,t){const s=document.createElement("style");s.textContent=e,s.setAttribute("type","text/css"),s.setAttribute("dd-ref",t),document.head.appendChild(s)}unplugCSS(e){const t=document.querySelector(`style[dd-ref="${e}"]`);t&&t.remove()}setTitle(e){document.title=e}setDescription(e){const t=document.head.querySelector('meta[name="description"]');if(!t)throw new Error('The meta[name="description"] tag is not placed in the HTML file.');t.setAttribute("content",e)}setKeywords(e){const t=document.head.querySelector('meta[name="keywords"]');if(!t)throw new Error('The meta[name="keywords"] tag is not placed in the HTML file.');t.setAttribute("content",e)}setLang(e){document.querySelector("html").setAttribute("lang",e)}async grabFileContent(e=""){const t={encodeURI:!0,timeout:2e4,retry:0,retryDelay:0,maxRedirects:0,headers:{accept:"*/*"}},s=new y(t);let n;if(/^http/.test(e))n=e;else{const o=`${window.location.protocol}//${window.location.host}`;n=new URL(e,o).toString()}const r=await s.askHTML(n);if(!r)throw new Error(`No answer for ${n}`);if(r.status!==200)throw new Error(`Status isn't 200 for ${n}. HTTP Status: ${r.status}`);if(!r.res.content)throw new Error(`Content is empty for ${e}`);let i=r.res.content;return i=i.replace('<script type="module" src="/@vite/client"><\/script>',"").trim(),i}loadI18n(e){const t=window[this.$appName].i18n[e];if(!t)throw new Error(`The language "${e}" is not defined. Please create language files in i18n/${e} folder.`);this.$model.$i18n=t}_hide_ddElements(e){const t=document.createElement("div");t.innerHTML=e;const s=[...this.$dd.noncloner_directives,...this.$dd.cloner_directives];for(const r of s){const i=t.querySelectorAll(`[${r}]`);for(const o of i)this._elemHide(o,r),this._uid(o)}return t.innerHTML}}class F extends L{constructor(){super(),this.$model={},this.$modeler={},this.$model.on=m.on.bind(m),this.$model.offAll=m.offAll.bind(m)}proxifyModel(){const e={set:(t,s,n)=>{var i;(i=this.$debugOpts)!=null&&i.model&&console.log(`DEBUG: Model set trigered. this.$model.${s} = `,n," | __initFinished:",this.__initFinished);const r=Reflect.set(t,s,n);return this.__initFinished&&this.render(s),m.emit("model-change",{modelName:s,modelValue:n}),r}};this.$model=new Proxy(this.$model,e)}modeler(){this.$modeler.use=e=>{if(!this.$model[e]){this._printWarn(`Error in this.$modeler.use('${e}'). Init the this.$model."${e}".`);return}return{setValue:(s,n)=>{const r=n?`$model.${e}.${n}`:`$model.${e}`;this._setControllerValue(r,s),this.render(e)},delValue:s=>{const n=s?`$model.${e}.${s}`:`$model.${e}`;this._setControllerValue(n,void 0),this.render(e)},getValue:s=>{const n=s?`$model.${e}.${s}`:`$model.${e}`;return this._getControllerValue(n)},mpush:s=>{this.$model[e].push(s),this.render(e)},mpop:()=>{this.$model[e].pop(),this.render(e)},munshift:s=>{this.$model[e].unshift(s),this.render(e)},mshift:()=>{this.$model[e].shift(),this.render(e)},mreverse:()=>{this.$model[e].reverse(),this.render(e)},mrender:()=>{this.render(e)}}}}emptyModel(){this.$model={}}isModelEmpty(){return!Object.keys(this.$model).length}}class b extends F{constructor(){super(),this.__initFinished=!1}async controllerMdw(e){this.proxifyModel(),this.modeler();try{await this.__loader(e)}catch(t){console.error(t)}this.ddLazyjs("after__loader"),this.prerender();try{await this.__init(e)}catch(t){console.error(t)}this.__initFinished=!0;try{await this.__rend(e)}catch(t){console.error(t)}this.ddLazyjs("after__rend");try{await this.__postrend(e)}catch(t){console.error(t)}}async __loader(e){throw new Error("The controller method __loader() is not defined. You probably got a blank screen.")}async __init(e){}async __rend(e){await this.render()}async __postrend(e){}async __destroy(){}async render(e,t=30){this._debug("render",`--------- render (start) -- ctrl: ${this.constructor.name} -- renderDelay: ${t}  ------`,"green","#D9FC9B"),this.ddEach(e),this.ddRepeat(e),this.ddElem(e),this.ddText(e),this.ddHtml(e),this.ddValue(e),this.ddDisabled(e),this.ddChecked(e),this.ddSelected(e),this.ddClass(e),this.ddStyle(e),this.ddSrc(e),this.ddAttr(e),this.ddIf(e),this.ddVisible(e),this._purgeDdRender("disabled"),this._purgeDdRender("enabled"),await new Promise(s=>setTimeout(s,t)),this.ddUNLISTEN(),this.ddHref(),this.ddSet(),this.ddModel(),this.ddClick(),this.ddEnter(),this.ddKeyup(),this.ddChange(),this.ddEvt(),this._debug("render",`--------- render (end) -- ctrl: ${this.constructor.name} ------`,"green","#D9FC9B")}prerender(){this.ddSetinitial(),this.ddHref()}}class N{constructor(e){if(!document)throw new Error("The document is not available.");this.cookieOpts=e}put(e,t){if(t===""||typeof t!="string")throw new Error(`ERR Cookie::put() - The "${e}" value must be non-empty string`);const s=encodeURIComponent(t);let n=`${e}=${s};`;n=this._appendCookieOptions(n),document.cookie=n}putObject(e,t){if(typeof t!="object"||!Object.keys(t).length)throw new Error(`ERR Cookie::putObject() - The "${e}" value must be non-empty object`);const s=encodeURIComponent(JSON.stringify(t));let n=`${e}=${s};`;n=this._appendCookieOptions(n),document.cookie=n}get(e){const t=this._toCookiesArr();let s,n;return t.forEach(r=>{s=r.split("="),s[0]===e&&(n=s[1])}),n=n?decodeURIComponent(n):void 0,n}getObject(e){const t=this.get(e);let s;try{t&&(s=JSON.parse(t))}catch{console.error("ERR Cookie::getObject(): Cookie value has invalid JSON and can not be converted to Object. Use get() method instead getObject()")}return s}getAll(){return document.cookie.split(";").filter(n=>!!n).map(n=>{const r=n.split("=");let i=r[0]||"";if(i=i.trim(),!i)return;let o=r[1]||"";return o=o.trim(),o=o?decodeURIComponent(o):void 0,{[i]:o}})}getObjectAll(e=!0){const s=document.cookie.split(";").filter(r=>!!r),n={};return s.forEach(r=>{const i=r.split("=");let o=i[0]||"";if(o=o.trim(),!o)return;let d=i[1]||"";d=d.trim(),d=d?decodeURIComponent(d):void 0,e&&(d=this._stringTypeConvert(d)),n[o]=d}),n}remove(e){let t=new Date("1970-01-01T01:00:00");t=t.toUTCString(),document.cookie=`${e}=;expires=${t};path=/;`}removeAll(){let e=new Date("1970-01-01T01:00:00");e=e.toUTCString();const t=this._toCookiesArr();let s;t.forEach(n=>{s=n.split("="),document.cookie=`${s[0]}=;expires=${e};path=/;`})}exists(e){const t=this._toCookiesArr();let s,n=!1;return t.forEach(r=>{s=r.split("="),s[0]===e&&(n=!0)}),n}_appendCookieOptions(e){if(!this.cookieOpts)return e;if(this.cookieOpts.domain){const t=`domain=${this.cookieOpts.domain};`;e+=t}if(this.cookieOpts.path){const t=`path=${this.cookieOpts.path};`;e+=t}if(this.cookieOpts.expires){let t;if(typeof this.cookieOpts.expires=="number"){const n=new Date;n.setTime(n.getTime()+this.cookieOpts.expires*60*60*1e3),t=n.toUTCString()}else t=this.cookieOpts.expires.toUTCString();const s=`expires=${t};`;e+=s}if(this.cookieOpts.secure&&(e+="secure;"),this.cookieOpts.httpOnly&&(e+="HttpOnly;"),this.cookieOpts.sameSite){const t=`SameSite=${this.cookieOpts.sameSite};`;e+=t}return e}_toCookiesArr(){return document.cookie.split(";").map(n=>n.trim())}_stringTypeConvert(e){function t(s){try{JSON.parse(s)}catch{return!1}return!0}return e&&!isNaN(e)&&!/\./.test(e)?e=parseInt(e,10):e&&!isNaN(e)&&/\./.test(e)?e=parseFloat(e):(e==="true"||e==="false"||t(e))&&(e=JSON.parse(e)),e}}class V{constructor(e){this.authOpts=e;const t={path:"/",expires:5,secure:!1,httpOnly:!1,sameSite:"strict"};this.cookie=new N(t);const s={encodeURI:!1,timeout:8e3,retry:3,retryDelay:5500,maxRedirects:3,headers:{authorization:"",accept:"*/*","content-type":"text/html; charset=UTF-8"},responseType:""};this.httpClient=new y(s),this.jwtToken,this.loggedUser=this.getLoggedUserInfo()}async login(e){const t=this.authOpts.apiLogin,s=await this.httpClient.askJSON(t,"POST",e),n=s.res.content||[];if(s.status===200){this.jwtToken=n.jwtToken,this.loggedUser=n.loggedUser,this.cookie.put("auth_jwtToken",n.jwtToken),this.cookie.putObject("auth_loggedUser",n.loggedUser);const r=this._correctURL(this.authOpts.afterGoodLogin,n.loggedUser);return r&&f.goto(r),n}else{this.loggedUser=null,this.cookie.removeAll();let r="Bad Login";for(const[i,o]of Object.entries(n))/msg|message/.test(i)&&(r=o);throw new Error(r)}}async logout(e){this.cookie.removeAll(),this.loggedUser=void 0,await new Promise(s=>setTimeout(s,e));const t=this._correctURL(this.authOpts.afterLogout,null);t&&f.goto(t)}getLoggedUserInfo(){return this.loggedUser||this.cookie.getObject("auth_loggedUser")}setLoggedUserInfo(e){this.loggedUser=e,this.cookie.putObject("auth_loggedUser",e)}getJWTtoken(){return this.jwtToken||this.cookie.get("auth_jwtToken")}autoLogin(){const e=this.getLoggedUserInfo();if(e&&e.username){const t=this._correctURL(this.authOpts.afterGoodLogin,e);throw t&&f.goto(t),new Error(`AuthWarn:: Autologin to ${t} is triggered.`)}}isLogged(){const e=this.getLoggedUserInfo();if(!(!!e&&!!e.username)){const s=this._correctURL(this.authOpts.afterBadLogin,e);throw s&&f.goto(s),new Error("AuthWarn:: This route is blocked because the user is not logged in.")}}hasRole(){const e=this.getLoggedUserInfo(),t=window.location.pathname+window.location.search;let s=!1;if(e&&e.role&&(s=t.indexOf(e.role)!==-1),!s){const n=this._correctURL(this.authOpts.afterBadLogin,e);throw n&&f.goto(n),new Error("AuthWarn:: This route is blocked because the user doesn't have valid role.")}}_correctURL(e,t){let s;return t&&t.role?s=e?e.replace("{loggedUserRole}",t.role):"":s=e||"",s}}const D={apiLogin:"http://localhost:8001/panel/login",afterGoodLogin:"/panel/{loggedUserRole}/dashboard",afterBadLogin:"/panel/login",afterLogout:"/panel/login"},U=new V(D),j={exeRoute:!1,render:!1,model:!1,ddInc:!1,loadView:!1,unloadView:!1,ddLazyjs:!1,loadHead:!1,ddSetinitial:!1,ddElem:!1,ddValue:!1,ddShow:!1,ddDisabled:!1,ddChecked:!1,ddClass:!1,ddStyle:!1,ddSrc:!1,ddAttr:!1,ddForeach:!1,ddRepeat:!1,ddIf:!1,ddText:!1,ddHtml:!1,ddMustache:!1,ddUNLISTEN:!1,ddHref:!1,ddSet:!1,ddModel:!1,ddClick:!1,ddEnter:!1,ddKeyup:!1,ddChange:!1,ddEvt:!1},M={encodeURI:!0,timeout:21e3,responseType:"",retry:0,retryDelay:1300,maxRedirects:0,headers:{authorization:"",accept:"*/*","content-type":"text/html; charset=UTF-8"}},B=new y(M),$=`<a href="/" dd-href>HOME</a>
<a href="/page1" dd-href>PAGE 1</a>
<a href="/bad" dd-href>BAD URL</a>
<b>&nbsp;</b>
`,H=`<h1>DoDo Framework</h1>
<p class="image">
  <img src="/img/dodo-framework.png" alt="DoDo Framework">
  <br>
  <br>Blazing fast, easy to learn, Javascript, frontend framework for reactive web pages &amp; apps
  <br>
  <br><a href="http://dodo.mikosoft.info" target="_blank">http://dodo.mikosoft.info</a>
</p>
`,w=`<b>FOOTER</b>
`;class q extends b{constructor(e){super()}async __loader(e){this.setTitle("DoDo - Single Page App Framework"),this.setDescription("DoDo is JS framework for single page applications."),this.setKeywords("dodo, framework, javascript, js, single page app, spa"),this.setLang("en"),this.loadView("#navbar",$),this.loadView("#main",H),this.loadView("#footer",w)}async __init(e){console.log("init() -- trx::",e),console.log("init() -- navig::",f),console.log("init() -- ctrl::",this),this.something="smthng"}async __postrend(e){console.log("postrend() -- trx::",e)}async __destroy(){console.log("destroy() -- navig::",f),console.log("destroy() -- ctrl::",this),this.unloadCSS(["https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-coy.min.css"]),this.unloadJS()}}const I=`<h1>Page 1</h1>
<p><b>Router Works</b> really good !</p>
`;class P extends b{constructor(e){super()}async __loader(e){this.setTitle("Page 1"),this.setDescription("DoDo is JS framework for single page applications which runs in a browser."),this.setKeywords("dodo, framework, javascript, js, single page app, spa"),this.setLang("en"),this.loadView("#navbar",$),this.loadView("#main",I),this.loadView("#footer",w)}}const J=`<p>Error 404: Not Found</p>
`;class G extends b{async __loader(e){this.setTitle("DoDo - NOT FOUND"),this.loadView("#navbar",$),this.loadView("#main",J),this.loadView("#footer",w)}async __postrend(e){this.$model.uri=e.uri}}const W=[["when","/",q],["when","/page1",P],["notfound",G]],E=new k("myDodoApp");E.auth(U).httpClient(B).debug(j);E.routes(W).listen();
